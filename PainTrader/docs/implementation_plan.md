## 1. 프로젝트 개요
**키움증권(Kiwoom) REST API**를 활용한 국내 주식 자동매매 시스템입니다. 사용자 선택에 따라 다양한 AI 모델과 매매 전략을 적용할 수 있습니다.

## 2. 아키텍처 개요
시스템은 관심사의 분리와 확장성을 보장하기 위해 계층화된 아키텍처를 따릅니다.

### 2.0. 시스템 구조도 (System Flow)
```mermaid
graph TD
    User[사용자 (User)] <--> UI[UI 계층 (PyQt6)]
    
    subgraph "Main Program (64-bit Python)"
        UI <--> Control[메인 컨트롤러]
        Control <--> Strategy[전략/AI 엔진]
        Control <--> DataMgr[데이터 관리자 (DB/Mem)]
        
        Strategy -->|Signal| OrderMgr[주문 관리자]
        DataMgr <-->|Data| Strategy
        
        DataMgr <--> REST_Client[공식 REST API 클라이언트]
        OrderMgr --> REST_Client
        *   **실시간**: `websockets` 라이브러리로 키움 공식 WS 서버 접속.
        *   **과거 데이터**: `requests` 라이브러리로 REST API 호출.
    *   **데이터베이스 (Database)**: OHLCV 데이터, 거래 내역, 로그, AI 모델 가중치를 저장합니다. (SQLite).

2.  **분석 계층 (두뇌)**
    *   **특성 공학 (Feature Engineering)**: 기술적 지표(RSI, MACD, 볼린저 밴드 등) 계산.
    *   **AI 엔진 (AI Engine) - 사용자 선택 가능**:
        *   **플러그인 구조**: 다양한 AI 모델을 모듈식으로 교체 가능.
        *   *옵션 예시*:
            *   **가격 예측 (Price Prediction)**: LSTM, Transformer (미래 가격 추세 예측).
            *   **강화 학습 (RL Agent)**: PPO, DQN (직접 매수/매도 행동 학습).
            *   **앙상블 (Ensemble)**: 여러 모델의 예측을 종합.
    *   **조건검색 (Condition Search)**: 키움증권 HTS에서 작성한 조건검색식을 로드하여 실시간 종목 포착.

3.  **결정 계층 (전략)**
    *   **전략 엔진 (Strategy Engine) - 사용자 선택 및 상세 설정 가능**:
        *   **유명 전략 라이브러리 (Built-in Strategies)**:
            *   **변동성 돌파 (Volatility Breakout)**: 래리 윌리엄스의 유명 전략.
            *   **이동평균 교차 (MA Crossover)**: 골든크로스/데드크로스 기반.
            *   **RSI 스윙 (RSI Swing)**: 과매수/과매도 구간 역매매.
            *   **볼린저 밴드 반전 (Bollinger Reversal)**: 밴드 이탈 후 회귀 매매.
            *   **AI 하이브리드**: 위 전략들에 AI 예측 점수를 가중치로 결합.
        *   **상세 파라미터 설정 (Advanced Config)**: 각 전략의 핵심 변수(기간, 임계값, 익절/손절 비율 등)를 UI에서 정밀하게 조정 가능.
    *   **리스크 관리 (Risk Management)**: 포지션 사이징, 손절/익절 동적 조정, 미수/신용 사용 여부 설정.
    *   **정밀 백테스터 (High-Precision Backtester)**:
        *   **시뮬레이션**: 과거 데이터를 기반으로 전략 수익률 검증.
        *   **현실성 반영**: 수수료(0.015%), 슬리피지(Slippage) 반영하여 실제 매매와 유사한 환경 제공.
        *   **성과 분석**: 승률, 손익비, MDD(최대 낙폭), Sharpe Ratio 등 상세 리포트 생성.

4.  **실행 계층 (행동)**
    *   **주문 관리자 (Order Manager)**: 키움 API를 통해 주문 전송. (지정가/시장가/최유리지정가 등).
    *   **트레이더 (Trader)**: 미체결 주문 감시, 정정/취소 주문, 잔고 편입 확인.
    *   **알림 (Notifier) - 카카오톡 중심**:
        *   **메인 채널**: **카카오톡 (KakaoTalk)**.
        *   **알림 유형**: 매매 체결, 에러, 일일 리포트, AI 신호, 조건검색 포착.

5.  **사용자 인터페이스 (제어)**
    *   **대시보드**: 실시간 차트, 계좌 잔고(예수금, 총매입), 보유 종목 현황.
    *   **설정**: 전략 및 리스크 관리 파라미터 구성, 자동 로그인 설정.
    *   **로그**: 시스템 상태 및 거래 실행 로그.

## 3. 기술 스택 (확정)
*   **언어**: Python 3.10+ (**64-bit 사용 가능** - 공식 REST API 사용).
*   **GUI**: PyQt6 (최신 버전 사용 가능).
*   **데이터 처리**: Pandas, NumPy.
*   **AI/ML**: PyTorch 또는 TensorFlow (**64-bit 네이티브 지원**으로 성능 및 호환성 확보).
*   **데이터베이스**: SQLite.

## 4. 워크플로우
1.  **초기화**: 자동 로그인, DB 연결, 키움 API 초기화.
2.  **데이터 루프**: 실시간 데이터(주식체결, 주식호가) + 조건검색 실시간 편입.
3.  **분석**: 지표 업데이트 -> AI 모델/전략 판단.
4.  **결정**: 매수/매도 신호 생성 -> 리스크 관리 확인.
5.  **실행**: 주문 전송 -> 체결 확인 -> DB 업데이트.
6.  **피드백**: 결과 로깅.

## 5. 다음 단계 (확정)
*   **타겟 시장**: **국내 주식 (Kiwoom) 단독**.
*   **AI 접근 방식**: 사용자 선택 가능.
*   **매매 전략**: 사용자 선택 가능.
*   **UI 프레임워크**: PyQt (데스크탑).
*   **상세 설계 시작**: 데이터 수집 및 처리 모듈 (키움 전용).

## 6. 추가 고려사항 (키움 특화)
*   **모의 투자**: 키움증권 상시 모의투자 시스템 활용.
*   **32비트 제약**: Python 32bit 환경 구성 필수. AI 라이브러리 호환성 문제 시 **64비트 AI 서버와 통신(Socket/ZMQ)**하는 구조 고려 필요.
*   **자동 로그인**: KOA Studio 등을 활용한 자동 로그인 설정.
