# 대시보드 및 시각화 구현 검토 보고서

## 1. 현황 분석
현재 `ui/dashboard.py`는 기본적인 테이블 형태의 시세 목록(`QTableWidget`)과 상단 매크로 지표 표시 기능만 구현되어 있습니다. `docs/task.md`의 "Phase 2: Dashboard" 계획에 포함된 실시간 차트와 호가창 기능이 부재한 상태입니다.

### 현재 구현된 기능
- **매크로 데이터**: KOSPI, KOSDAQ, 환율 표시 (단순 텍스트 라벨)
- **실시간 시세**: 종목명, 현재가, 등락률, 거래량 테이블 표시
- **데이터 연동**: `DataCollector`로부터 시그널을 받아 UI 업데이트하는 구조는 잡혀있음

### 미구현 기능 (Task 목록 기준)
- **RealTimeChart**: 캔들스틱 차트, 이평선, 매매 마커
- **OrderBook**: 10단계 호가창, 잔량 그래프, 체결강도

---

## 2. 기술적 고려사항 및 권장사항

### 2.1 차트 라이브러리 선정: PyQtGraph
- **선정 이유**: Matplotlib은 실시간 갱신에 느리고, QtCharts는 라이선스 및 기능 제약이 있을 수 있음. PyQtGraph는 대량의 데이터 포인트(수만 개)를 실시간으로 렌더링하는 데 최적화되어 있어 트레이딩 시스템에 적합합니다.
- **구현 포인트**:
    - `CandlestickItem` 커스텀 클래스 구현 필요 (PyQtGraph 기본 예제 활용)
    - **AxisItem**: X축을 시간축으로 변환하여 표시 (Timestamp -> HH:MM)
    - **Crosshair**: 마우스 오버 시 십자선 및 가격/시간 툴팁 표시 기능 필수

### 2.2 실시간 데이터 처리 최적화
- **Throttle/Debounce**: 틱 데이터가 초당 수십 건 들어올 때마다 `repaint`를 호출하면 UI가 멈춥니다. 
    - **권장**: 데이터는 버퍼에 쌓고, UI 갱신은 `QTimer`를 사용하여 고정 프레임(예: 30fps 또는 100ms 간격)으로 제한해야 합니다.
- **Partial Update**: 차트 전체를 다시 그리는 대신, 마지막 캔들만 업데이트하거나 새로운 캔들을 append 하는 방식으로 처리해야 합니다.

### 2.3 호가창 (OrderBook) 시각화
- **Bar Chart Overlay**: 호가 잔량을 숫자로만 보여주지 말고, 배경에 가로 막대 그래프(Bar Chart)를 겹쳐서 시각적으로 잔량 분포를 알 수 있게 해야 합니다.
- **Center Alignment**: 매도 호가는 위에서 아래로, 매수 호가는 위에서 아래로 정렬하되, 현재가가 중앙에 오도록 배치하여 직관성을 높여야 합니다.
- **체결 강도**: 별도의 게이지나 색상 변화로 매수/매도 우위를 표현하면 좋습니다.

---

## 3. UX/UI 디자인 고려사항

### 3.1 레이아웃 및 유연성
- **Dock System**: `QDockWidget`을 활용하여 사용자가 차트, 호가창, 주문창의 위치를 자유롭게 배치하고 크기를 조절할 수 있게 해야 합니다. (멀티 모니터 대응)
- **Linked Views**: 차트에서 종목을 클릭하거나 변경하면, 호가창과 주문창도 해당 종목으로 즉시 동기화되어야 합니다.

### 3.2 시인성 강화 (Visual Hierarchy)
- **Color Coding**: 상승(빨강)/하락(파랑) 색상을 일관되게 적용하되, 너무 눈이 아프지 않은 파스텔 톤이나 채도를 조절한 색상 테마를 사용합니다. (Dark Mode 기준)
- **Flash Effect**: 체결이 발생하거나 호가가 변경될 때 배경이 살짝 깜빡이는 효과를 주어 역동성을 부여합니다.

### 3.3 트레이딩 연동 (Actionable UI)
- **Chart Trading**: 차트 상에서 마우스 우클릭으로 "매수/매도" 주문을 바로 낼 수 있는 컨텍스트 메뉴나, 가격 라인을 드래그하여 주문 정정하는 기능은 고급 기능으로 고려해볼 만합니다.
- **OrderBook Trading**: 호가창의 특정 가격을 더블 클릭하면 해당 가격으로 지정가 주문이 입력되도록 단축 기능을 제공해야 합니다.

---

## 4. 구현 로드맵 제안

### Step 1: 차트 위젯 기초 구현 (`ui/widgets/chart_widget.py`)
- PyQtGraph 설치 및 기본 캔들스틱 렌더링
- Zoom/Pan 기능 및 X축 시간 포맷팅

### Step 2: 호가창 위젯 구현 (`ui/widgets/orderbook_widget.py`)
- 10단계 호가 테이블 레이아웃 구성
- 호가 잔량 시각화 (ProgressBar 활용 또는 커스텀 페인팅)

### Step 3: 대시보드 통합 및 데이터 연동
- `Dashboard` 클래스에 위젯 배치
- `EventBus` 또는 Signal을 통한 실시간 데이터 바인딩 최적화 (Timer 기반 갱신)

### Step 4: 인터랙션 및 편의기능 추가
- 십자선(Crosshair), 매매 마커(Buy/Sell Annotation) 표시
- 호가창 클릭 주문 연동

## 5. 코드 구조 정리 제안
- 현재 `ui/header_bar.py`와 `ui/widgets/header_bar.py`가 중복 존재하는 것으로 보입니다. `ui/widgets/` 패키지 하위로 재사용 가능한 컴포넌트들을 모으고, `ui/` 루트에는 메인 윈도우나 다이얼로그 같은 컨테이너만 두는 구조로 정리가 필요합니다.
